<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>改变原数组的方法</title>
  </head>
  <body></body>

  <!--  
    Array.prototype.push(...args)
    向源数组末尾增加元素，返回新数组的长度，改变原数组
  -->
  <script>
    var arr = [4, 5, 6];
    console.log(arr.push(1, 2, 3)); // 6
    console.log(arr); // [4, 5, 6, 1, 2, 3]

    // 源码实现
    Array.prototype.push = function () {
      for (var i = 0; i < arguments.length; i++) {
        this[this.length] = arguments[i];
      }
      return this.length;
    };
  </script>

  <!--  
    Array.prototype.unshift(...args)
    向源数组开始头部增加元素，返回新数组的长度，改变原数组
  -->
  <script>
    var arr = [4, 5, 6];
    console.log(arr.unshift(1, 2, 3)); // 6
    console.log(arr); // [1, 2, 3, 4, 5, 6]

    // 在非数组对象中使用
    var obj = {};
    Array.prototype.unshift.call(obj, 1, 2);
    console.log(obj); // { 0: 1, 1: 2, length: 2 }

    // 源码实现
    // [1, 2, 3]
    // unshift(4, 5)
    // i = 2 [1, 2, 3, x, 3]
    // i = 1 [1, 2, 3, 2, 3]
    // i = 0 [1, 2, 1, 2, 3]
    // j = 0 [4, 2, 1, 2, 3]
    // j = 1 [4, 5, 1, 2, 3]
    Array.prototype.unshift = function () {
      var idx = arguments.length;
      for (var i = this.length - 1; i >= 0; i--) {
        this[i + idx] = this[i];
      }
      for (var j = 0; j < arguments.length; j++) {
        this[j] = arguments[j];
      }
      return this.length;
    };
  </script>

  <!--  
    Array.prototype.pop()
    向源数组删除最后一个元素，返回被删除的数（如果数组为空则返回 undefined），改变原数组
  -->
  <script>
    var arr = [4, 5, 6];
    console.log(arr.pop()); // 6
    console.log(arr.pop()); // 5
    console.log(arr.pop()); // 4
    console.log(arr.pop()); // undefined

    // 类数组对象的应用
    var obj = {
      length: 3,
      0: 'a',
      1: 'b',
      2: 'c',
      removeItem: function () {
        return [].pop.call(this);
      },
    };
    console.log(obj.removeItem());

    // 源码实现
    Array.prototype.pop = function () {
      cur = this[this.length - 1];
      this.length--;
      return cur;
    };
  </script>

  <!--  
    Array.prototype.shift()
    向源数组删除第一个元素，返回被删除的数（如果数组为空则返回 undefined），改变原数组
  -->
  <script>
    var arr = [4, 5, 6];
    console.log(arr.shift()); // 4
    console.log(arr.shift()); // 5
    console.log(arr.shift()); // 6
    console.log(arr.shift()); // undefined

    // while 循环使用删除
    var names = ['ming', 'lili', 'cuzz'];
    while (typeof (i = names.shift()) !== 'undefined') {
      console.log(i);
    }

    // 源码实现
    // [1, 2, 3]
    // i = 0 [2, 3, undefined]
    Array.prototype.shift = function () {
      var cur = this[0];
      // or = this.reverse()
      for (var i = 0; i < this.length; i++) {
        this[i] = this[i + 1];
      }
      this.length--;
      return cur;
    };
  </script>

  <!--  
    Array.prototype.splice(startIdx, delCount, ...args)
    增删改源数组，返回被删除元素组成的数组，若没有被删除的元素则返回空数组，改变原数组
  -->
  <script>
    var arr = ['parrot', 'anemone', 'blue', 'trumpet', 'sturgeon'];
    console.log(arr.splice(arr.length - 3, 2)); // ['blue', 'trumpet']
    console.log(arr.splice(-2, 1)); // ['trumpet']
    console.log(arr.splice(2)); // ['blue', 'trumpet', 'sturgeon']

    // 获取指定的下标元素
    function splice(idx, arr) {
      return (idx += idx >= 0 ? 0 : arr.length);
    }
    console.log(arr[splice(3, arr)]); // 'trumpet'
    console.log(arr[splice(-3, arr)]); // 'blue'

    // 源码实现
    Array.prototype.splice = function () {
      // 未完待续...
    };
  </script>

  <!--  
    Array.prototype.reverse()
    反转数组，返回反转后的数组引用，改变原数组
  -->
  <script>
    var arr = [1, 2, 3];
    console.log(arr.reverse()); // [3, 2, 1]
    console.log(arr); // [3, 2, 1]

    // 对类数组进行使用
    var obj = {
      5: 'a',
      9: 'b',
      2: 'c',
      length: 3,
    };
    console.log(Array.prototype.reverse.call(obj));

    // 源码实现
    // [1, 2, 3]
    // i = 0 [3, 2, 1]
    // i = 1 [3, 2, 1]
    Array.prototype.reverse = function () {
      for (var i = 0; i < this.length / 2; i++) {
        var temp = this[i];
        this[i] = this[this.length - 1 - i];
        this[this.length - 1 - i] = temp;
      }
      return this;
    };
  </script>

  <!--  
    Array.prototype.sort(fn?)
    数组排序，如果省略参数，元素按照转换为的字符串的各个字符的 Unicode 码进行排序
    改变原数组

    1. 正值，a 在前
    2. 负值，b 在前
    3. 0，则不改变
  -->
  <script>
    var arr = [12, 32, 1, 2, 90, 56];
    arr.sort(); // [1, 12, 2, 32, 56, 90]
    /**
     * function compareFn() {
     *    if(a 大于 b){
     *      return 1
     *    }else if(a 小于 b){
     *      return -1
     *    }else if(a === b){
     *      return 0
     *    }
     * }
     */
    arr.sort((a, b) => a - b); // [1, 2, 12, 32, 56, 90]
    arr.sort(() => Math.random() - 0.5); // 随机排列 => Math.random 开区间 0-1

    // 源码实现
    Array.prototype.sort = function () {
      // 未完待续...
    };
  </script>
</html>
