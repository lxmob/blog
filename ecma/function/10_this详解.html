<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>thisæŒ‡å‘è¯¦è§£</title>
  </head>
  <body>
    <button onclick="console.log(this)">btn</button><br />
    <button onclick="(function(){console.log(this)})()">btn2</button><br />
    <button id="button">button</button>
  </body>
  <!-- 
    this æŒ‡ä»£çš„æ˜¯å½“å‰çš„å®ä¾‹æˆ–è€…è°ƒç”¨è€…
  -->

  <!-- 
    å…¨å±€ç¯å¢ƒä¸­è°ƒç”¨å‡½æ•° this éä¸¥æ ¼æ¨¡å¼ä¸‹æŒ‡å‘çš„æ˜¯ window åä¹‹ undefined 
  -->
  <script>
    // "use strict";
    var a = "window => a";
    global.b = "global => b";

    var obj = {
      a: "obj => a",
      show: function () {
        console.log(this.a); // web
        console.log(window.a); // web
        console.log(self.a); // web å’Œ wokerçº¿ç¨‹ä¸‹çš„å…¨å±€å¯¹è±¡
        console.log(frames.a); // web
        console.log(global.b); // node ä¸­ä½¿ç”¨ global ä½œä¸ºå…¨å±€å¯¹è±¡
        console.log(globalThis.a); // é€šç”¨å…¨å±€å¯¹è±¡
      },
    };
    obj.show();

    // å…¨å±€ç¯å¢ƒéä¸¥æ ¼æ¨¡å¼ä¸‹è°ƒç”¨å‡½æ•° this æŒ‡å‘çš„æ˜¯ windowï¼Œä¸¥æ ¼æ¨¡å¼æ˜¯ undefined
    function thiss() {
      console.log(this);
    }
    thiss();
  </script>

  <!-- ç»ƒä¹ é¢˜ -->
  <script>
    function Foo() {
      getName = function () {
        console.log(1);
      };
      return this;
    }
    Foo.getName = function () {
      console.log(2);
    };
    Foo.prototype.getName = function () {
      console.log(3);
    };
    var getName = function () {
      console.log(4);
    };
    function getName() {
      console.log(5);
    }

    /**
     * GO = {
     *    Foo: fn,
     *    getName: undeinfed,
     *      -> fn(){console.log(5)},
     *      -> fn(){console.log(4)},
     *      -> fn(){console.log(1)}
     * }
     *
     */
    Foo.getName(); // 2
    getName(); // 4
    Foo().getName(); // 1
    getName(); // 1
    // è¿ç®—ç¬¦ä¼˜å…ˆçº§
    // . > new
    // () > . => new Foo() => .
    new Foo.getName(); // 2
    new Foo().getName(); // 3
    new new Foo().getName(); // 3
  </script>

  <!-- 
    dom äº‹ä»¶ä¸­çš„ this
    åœ¨ dom äº‹ä»¶ç»‘å®šçš„ thisï¼ŒæŒ‡å‘çš„æ˜¯ç»‘å®šäº‹ä»¶çš„è¯¥ dom å…ƒç´ 

    é€šè¿‡ bind æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ”¹å˜æ–¹æ³•è°ƒç”¨çš„ this æŒ‡å‘ï¼Œ
    å½“è§¦å‘ click äº‹ä»¶æ—¶æˆ‘ä»¬å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¼šè¾“å‡º {name: 'bind', event: 'onclick'} æŒ‡å‘æ˜¯å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œ
    å¦‚æœä¸é€šè¿‡æ”¹å˜ this æŒ‡å‘é»˜è®¤æŒ‡å‘çš„æ˜¯äº‹ä»¶æºã€‚
  -->
  <script>
    (function (doc) {
      const dom = doc.getElementById("button");

      function Bind() {
        this.name = "bind";
        this.event = "onclick";
        this.init();
      }

      Bind.prototype.init = function () {
        this.bind();
      };
      Bind.prototype.bind = function () {
        // dom.onclick = this.click
        // dom.onclick = this.click.bind(this)
        // dom.addEventListener('click', this.click, false)
        dom.addEventListener("click", this.click.bind(this), false);
      };
      Bind.prototype.click = function () {
        console.log(this, this.name);
      };

      window.Bind = Bind;
    })(document);

    new Bind();
  </script>

  <!-- 
    æ„é€ å‡½æ•°ä¸­çš„ this
    æ„é€ å‡½æ•°ä¸­çš„ this æŒ‡å‘å½“å‰çš„å®ä¾‹ã€‚
  -->
  <script>
    class Father {
      constructor(age) {
        this.age = age;
      }
      swim() {
        console.log("Go swimming!");
      }
    }
    class Son extends Father {
      constructor() {
        // super åšäº†ä»€ä¹ˆï¼Ÿ
        // 1. è°ƒç”¨Fatherçš„constructor
        // 2. ç”Ÿæˆthisç»‘å®š -> Father this -> Sonçš„å®ä¾‹
        // 3. this -> new Father() -> {age}
        super(60);
        this.hobby = "traval";
      }
      study() {
        console.log(this);
        this.swim();
      }
    }
    var s = new Son();
    s.study(); // s å®ä¾‹ -> Go swimming!
  </script>

  <!-- 
    å¯¹è±¡æ–¹æ³•ä¸­çš„ this
    å¯¹è±¡èº«ä¸Šæ–¹æ³•è¢«è°ƒç”¨ this æŒ‡å‘çš„æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ã€‚
  -->
  <script>
    var obj = {
      a: "obj => a",
      show: function () {
        console.log(this);
      },
      mask: () => {
        console.log(this);
      },
    };
    obj.show(); // obj
    obj.mask(); // window ç®­å¤´å‡½æ•°çš„ this
    obj.mask.call(obj); // window å¿½ç•¥æ”¹å˜æŒ‡å‘
    obj.show.call(window); // window
    var fn = obj.show;
    fn(); // window
    fn.call(obj); // obj
  </script>

  <!-- 
    åŒ¿åå‡½æ•°ä¸­çš„ this
    åŒ¿åå‡½æ•°ä¸­çš„ this ä¼šæŒ‡å‘ window ä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯ undefinedã€‚
  -->
  <script>
    var obj = { name: "obj" };
    var fn = (function () {
      console.log(this); // window
      var fn = function () {
        console.log(this);
      }.bind(obj);
      fn(); // obj
      return function () {
        console.log(this);
      };
    })();

    fn(); // window
    fn.call(obj); // obj
  </script>

  <!-- 
    call å’Œ apply
    æ”¹å˜å‡½æ•°è°ƒç”¨æ—¶çš„ this æŒ‡å‘ã€‚
  -->
  <script>
    function Dog(eat, name) {
      this.eat = eat;
      this.name = name;
    }
    var d = {};
    Dog.call(d, "ç‹—ç²®", "å“ˆå£«å¥‡");
    Dog.apply(d, ["ç‹—ç²®", "å“ˆå£«å¥‡"]);
    console.log(d); // {eat: 'ç‹—ç²®', name: 'å“ˆå£«å¥‡'}

    // ğŸŒ° å€Ÿç”¨çˆ¶ç±»æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹
    function Compute() {
      this.plus = function () {
        console.log("plus");
      };
    }
    function FullCompute() {
      Compute.apply(this);
      this.div = function () {
        console.log("div");
      };
    }
    var cop = new Compute();
    cop.plus(); // plus
  </script>

  <!-- 
    bind ç»‘å®š this åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œthis åªä¼šç”Ÿæ•ˆä¸€æ¬¡ï¼Œæ— è®ºåç»­æ€æ ·è°ƒç”¨ï¼Œthis éƒ½æ˜¯åŒæ ·çš„å€¼ã€‚
  -->
  <script>
    var obj = { name: "obj" };
    var obj2 = { name: "obj2" };
    function test() {
      console.log(this.name);
    }
    var test1 = test.bind(obj);
    var test2 = test1.bind(obj2);
    var t = test.bind(obj).bind(obj2);
    test1(); // obj
    test2(); // obj
    t(); // obj
  </script>
</html>
