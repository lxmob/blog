<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>瀑布流</title>
    <style>
      .wf-wrap {
        position: relative;
        width: 1200px;
        margin: 0 auto;
      }
      .wf-item {
        position: absolute;
        background-color: #ededed;
        overflow: hidden;
      }
      .wf-item img {
        display: block;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="wf-wrap">
      <div class="wf-item"><img src="img/1.jpg" /></div>
      <div class="wf-item"><img src="img/2.jpg" /></div>
      <div class="wf-item"><img src="img/3.jpg" /></div>
      <div class="wf-item"><img src="img/4.jpg" /></div>
      <div class="wf-item"><img src="img/5.jpg" /></div>
      <div class="wf-item"><img src="img/6.jpg" /></div>
      <div class="wf-item"><img src="img/7.jpg" /></div>
      <div class="wf-item"><img src="img/8.jpg" /></div>
      <div class="wf-item"><img src="img/9.jpg" /></div>
      <div class="wf-item"><img src="img/10.jpg" /></div>
      <div class="wf-item"><img src="img/11.jpg" /></div>
      <div class="wf-item"><img src="img/12.jpg" /></div>
      <div class="wf-item"><img src="img/13.jpg" /></div>
      <div class="wf-item"><img src="img/14.jpg" /></div>
      <div class="wf-item"><img src="img/15.jpg" /></div>
      <div class="wf-item"><img src="img/16.jpg" /></div>
      <div class="wf-item"><img src="img/17.jpg" /></div>
      <div class="wf-item"><img src="img/18.jpg" /></div>
      <div class="wf-item"><img src="img/19.jpg" /></div>
      <div class="wf-item"><img src="img/20.jpg" /></div>
      <div class="wf-item"><img src="img/21.jpg" /></div>
      <div class="wf-item"><img src="img/22.jpg" /></div>
      <div class="wf-item"><img src="img/23.jpg" /></div>
      <div class="wf-item"><img src="img/24.jpg" /></div>
      <div class="wf-item"><img src="img/25.jpg" /></div>
      <div class="wf-item"><img src="img/26.jpg" /></div>
      <div class="wf-item"><img src="img/27.jpg" /></div>
      <div class="wf-item"><img src="img/28.jpg" /></div>
      <div class="wf-item"><img src="img/29.jpg" /></div>
      <div class="wf-item"><img src="img/30.jpg" /></div>
      <div class="wf-item"><img src="img/31.jpg" /></div>
      <div class="wf-item"><img src="img/32.jpg" /></div>
      <div class="wf-item"><img src="img/33.jpg" /></div>
      <div class="wf-item"><img src="img/34.jpg" /></div>
      <div class="wf-item"><img src="img/35.jpg" /></div>
      <div class="wf-item"><img src="img/36.jpg" /></div>
      <div class="wf-item"><img src="img/37.jpg" /></div>
      <div class="wf-item"><img src="img/38.jpg" /></div>
      <div class="wf-item"><img src="img/39.jpg" /></div>
      <div class="wf-item"><img src="img/40.jpg" /></div>
    </div>
  </body>

  <!-- 
    瀑布流是什么？
    瀑布流是一种 dom 结构在展现上的一种算法结构，并非是一种案例，如果单说案例就把它讲 low 了，
    最初是体现在纸质版杂志周刊上面的，后来才引入到 web 页面中去。

    如何实现？
    瀑布流可以通过 css flex 布局来实现，也可以通过 js 代码来实现，通常使用 js 实现比较多。

    具体思路
      1. 确定一行要排列几项（每行 5 张）
      2. 每一张图片由一个外部容器进行包裹，宽度是固定的，高度是由图片大小进行撑开，同时每 2 张图片存在间隔

      3. 排列时由于每张图片的高度不一致，第一行是固定的贴附顶部，
        从第二行开始排列，每当排列一张图片需要找出上一次排列中高度最短的项，
        然后进行依次排列。

      4. 如何找到每次排列中高度最短的项呢？
        首先所有的项都是通过绝对定位上去的，我们通过数组来记录排列时的高度，然后找出最短项的下标，
        通过下标找到元素，然后拿到元素 offsetLeft 值再加上边距，就能确定当前需要排列的位置。
  -->
  <script>
    (function (doc) {
      var oItems = doc.getElementsByClassName("wf-item"),
        oItemsLen = oItems.length,
        _arr = [];

      var init = function () {
        getImgsPos();
        console.log(_arr);
      };

      function getImgsPos() {
        var item = null;

        for (var i = 0; i < oItemsLen; i++) {
          item = oItems[i];
          item.style.width = "232px";

          if (i < 5) {
            _arr.push(item.offsetHeight);
            item.style.top = 0;
            // 第一列没有左间隔
            if ((i + 1) % 5 === 1) {
              item.style.left = 0;
            } else {
              item.style.left = i * (232 + 10) + "px";
            }
          } else {
            var minIdx = getMinIdx(_arr);
            item.style.top = _arr[minIdx] + 10 + "px";
            item.style.left = oItems[minIdx].offsetLeft + "px";
            // 排列好图片后增加当前列高度
            _arr[minIdx] += item.offsetHeight + 10;
          }
        }
      }

      function getMinIdx(arr) {
        return [].indexOf.call(arr, Math.min.apply(null, arr));
      }

      window.onload = function () {
        init();
      };
    })(document);
  </script>
</html>
