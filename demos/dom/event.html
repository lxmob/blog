<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>domäº‹ä»¶</title>
    <style>
      .wrapper {
        width: 300px;
        height: 300px;
        background-color: #1661ab;
      }
      .outer {
        width: 200px;
        height: 200px;
        background-color: #22a2c3;
      }
      .inner {
        width: 100px;
        height: 100px;
        background-color: #207f4c;
      }
    </style>
  </head>
  <body>
    <button id="btn" style="margin-bottom: 20px">è§¦å‘äº‹ä»¶</button>
    <!-- äº‹ä»¶å†’æ³¡ä¸æ•è· -->
    <div class="wrapper">
      <div class="outer">
        <div class="inner"></div>
      </div>
    </div>
    <!-- äº‹ä»¶å¯¹è±¡ -->
    <button id="btn-event" style="margin-top: 20px">è·å–äº‹ä»¶æº</button><br />
    <!-- äº‹ä»¶å§”æ‰˜ -->
    <button class="ul-btn" style="margin-top: 20px">å¢åŠ ç›®æ ‡</button>
    <ul>
      <li>1</li>
      <li>2</li>
      <li>3</li>
    </ul>
  </body>
  <script>
    // ğŸŒŸ äº‹ä»¶æ˜¯å…ƒç´ èº«ä¸Šæœ¬èº«å°±æœ‰çš„ï¼Œé€šè¿‡ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆäº‹ä»¶åé¦ˆï¼‰æ¥å®ç°å‰ç«¯çš„æ ¸å¿ƒï¼Œå°±æ˜¯å‰ç«¯äº¤äº’ä½“éªŒ
    var btnEl = document.getElementById('btn')

    // 1. onclick ä¼˜ç‚¹å…¼å®¹æ€§å¥½ï¼Œç¼ºç‚¹å¥æŸ„çš„å½¢å¼æ— æ³•ä¸ºå…ƒç´ äº‹ä»¶ç»‘å®šå¤šä¸ªå¤„ç†å‡½æ•°
    btnEl.onclick = function () {
      console.log('onclick1', this)
    }
    btnEl.onclick = function () {
      console.log('onclick2', this)
    }

    // 2. addEventListener(event, fn, false) ä¼˜ç‚¹å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç¼ºç‚¹å…¼å®¹æ€§IE9ä»¥ä¸‹ä¸æ”¯æŒï¼Œä½†æ˜¯å®ƒæ˜¯w3cçš„è§„èŒƒ
    btnEl.addEventListener(
      'click',
      function () {
        console.log('addEventListener1', this)
      },
      false
    )
    btnEl.addEventListener(
      'click',
      function () {
        console.log('addEventListener2', this)
      },
      false
    )
    // ç›¸åŒå‡½æ•°çš„å¼•ç”¨å¤„ç†åªæ‰§è¡Œä¸€æ¬¡
    function once() {
      console.log('once', this)
    }
    btnEl.addEventListener('click', once, false)
    btnEl.addEventListener('click', once, false)

    // 3. attachEvent(event, fn) IE8åŠä»¥ä¸‹çš„ç»‘å®šæ–¹æ³•
    // btnEl.attachEvent('onclick', function () {
    //   console.log('attachEvent', this) // this -> window
    // })

    // ğŸŒ° å…¼å®¹æ€§å°è£…
    function addEvent(el, type, fn) {
      if (el.addEventListener) {
        el.addEventListener(type, fn, false)
      } else if (el.attachEvent) {
        el.attachEvent('on' + type, fn.bind(el))
      } else {
        el['on' + type] = fn
      }
    }
    addEvent(btnEl, 'click', function () {
      console.log('addEvent', this)
    })

    // ğŸŒŸ äº‹ä»¶å¤„ç†å‡½æ•°çš„è§£é™¤æ–¹æ³•
    // 1. btnEl.onclick = null / false
    // 2. btnEl.removeEventListener('click', once, false)
    // 3. btnEl.detachEvent('onclick', once)

    // ğŸŒŸ äº‹ä»¶æµæ˜¯æè¿°é¡µé¢ä¸­è§¦å‘äº‹ä»¶çš„é¡ºåºï¼ˆå†’æ³¡ä¸æ•è·ï¼‰
    var wEl = document.getElementsByClassName('wrapper')[0],
      oEl = wEl.getElementsByClassName('outer')[0],
      iEl = oEl.getElementsByClassName('inner')[0]

    // 1. å†’æ³¡æœºåˆ¶ï¼ˆIE Event Bubblingï¼‰
    // äº‹ä»¶æµè§¦å‘ï¼šäº‹ä»¶æ•è·ï¼ˆä¸æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€ç›®æ ‡é˜¶æ®µï¼ˆæ‰§è¡Œï¼‰ã€äº‹ä»¶å†’æ³¡
    // ä»domçš„åµŒå¥—ç»“æ„ä¸Šæ¥è®²ï¼Œå®ƒæ˜¯ç”±è§¦å‘äº‹ä»¶çš„å†…éƒ¨å…ƒç´ äº‹ä»¶å¤„ç†å‡½æ•°ä¸€å±‚ä¸€å±‚çš„å‘å¤–ä¼ é€’çš„ç°è±¡ï¼Œå‰ææ˜¯çˆ¶å…ƒç´ ç›¸åŒçš„äº‹ä»¶ç»‘å®šå¯¹åº”çš„å¤„ç†å‡½æ•°
    wEl.addEventListener(
      'click',
      function () {
        console.log('bubble-wrapper')
      },
      false
    )
    oEl.addEventListener(
      'click',
      function () {
        console.log('bubble-outer')
      },
      false
    )
    iEl.addEventListener(
      'click',
      function () {
        console.log('bubble-inner')
      },
      false
    )
    // 2. æ•è·æœºåˆ¶ï¼ˆNetscape Event Capturingï¼‰
    // äº‹ä»¶æµè§¦å‘ï¼šäº‹ä»¶æ•è·ï¼ˆæ‰§è¡Œï¼‰ã€ç›®æ ‡é˜¶æ®µã€äº‹ä»¶å†’æ³¡
    // å®ƒæ˜¯ç”±å¤–å‘å†…ä¸€å±‚ä¸€å±‚çš„ä¾æ¬¡è§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œéœ€è¦å°† addEventListener ç¬¬ä¸‰ä¸ªå‚æ•°æ”¹ä¸º true
    wEl.addEventListener(
      'click',
      function () {
        console.log('wrapper')
      },
      true
    )
    oEl.addEventListener(
      'click',
      function () {
        console.log('outer')
      },
      true
    )
    iEl.addEventListener(
      'click',
      function () {
        console.log('inner')
      },
      true
    )
    // ğŸŒŸ å¦‚æœåŒæ—¶ä¸ºç›¸åŒçš„äº‹ä»¶ç»‘å®šäº†å¤„ç†å‡½æ•°ï¼Œä¸åŒçš„å¤„ç†æœºåˆ¶ï¼Œåˆ™å…ˆè§¦å‘æ•è·åå†’æ³¡

    // ğŸŒŸ ä»¥ä¸‹çš„äº‹ä»¶ä¸å­˜åœ¨å†’æ³¡å’Œæ•è·æœºåˆ¶
    // focus blur change submit reset select

    // ğŸŒŸ é˜»æ­¢å†’æ³¡äº‹ä»¶è§¦å‘
    // w3c: event.stopPropagation() IE: event.cancelBubble = true
    iEl.addEventListener(
      'click',
      function (event) {
        // event.stopPropagation()
        // event.cancelBubble = true
        // cancelBubble(event)
        console.log(event, 'inner-stopPropagation')
      },
      false
    )
    // ğŸŒ° å…¼å®¹æ€§å°è£…
    function cancelBubble(e) {
      var event = e || window.event
      if (event.stopPropagation) {
        event.stopPropagation()
      } else {
        event.cancelBubble = true
      }
    }

    // ğŸŒŸ å–æ¶ˆé»˜è®¤äº‹ä»¶
    document.oncontextmenu = function (event) {
      // 1. åªèƒ½åœ¨å¥æŸ„ä¸­ä½¿ç”¨çš„æ–¹å¼ return false
      // return false
      // 2. w3c: event.preventDefault() ä¸å…¼å®¹IE9ä»¥ä¸‹
      // event.preventDefault()
      // 3. IE9ä»¥ä¸‹ä½¿ç”¨ event.returnValue = false
      event.returnValue = false
      console.log('oncontextmenu')
    }

    // ğŸŒŸ è·å–äº‹ä»¶æºå¯¹è±¡ target srcElement
    var btnEvent = document.getElementById('btn-event')
    btnEvent.onclick = function (event) {
      var event = event || window.event
      console.log(event.target)
      console.log(event.srcElement)
    }
    // ğŸŒ° å…¼å®¹æ€§é—®é¢˜
    function eventTarget(e) {
      // IE8åŠä»¥ä¸‹eventå¯¹è±¡å­˜åœ¨ä¸windowèº«ä¸Š
      var event = e || window.event
      // FFåªæœ‰targetï¼ŒIEåªæœ‰srcElementï¼Œchromeéƒ½æœ‰
      return event.target ? event.target : event.srcElement
    }

    // ğŸŒŸ äº‹ä»¶å§”æ‰˜ äº‹ä»¶ä»£ç†
    // äº‹ä»¶æºé€šè¿‡å†’æ³¡çš„å½¢å¼æ¥è§¦å‘ç¥–çˆ¶çº§èº«ä¸Šç»‘å®šçš„ç›¸åŒäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯äº‹ä»¶å§”æ‰˜
    var ulEl = document.getElementsByTagName('ul')[0],
      btnEl = document.getElementsByClassName('ul-btn')[0]
    btnEl.onclick = function () {
      var liNode = document.createElement('li')
      liNode.innerText = ulEl.children.length + 1
      ulEl.appendChild(liNode)
    }
    ulEl.onclick = function (event) {
      var target = eventTarget(event)
      console.log(target)
    }
  </script>
</html>
