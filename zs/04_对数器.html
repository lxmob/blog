<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>对数器</title>
  </head>
  <body></body>

  <!-- 对数器 = 生成随机样本自己做比对的机器 -->
  <script>
    // Math.random() => double => [0, 1)
    // 一个等概率的获取随机数的方法
    function testRandom() {
      var testTime = 10000000,
        count = 0;
      for (var i = 0; i < testTime; i++) {
        // if (Math.random() < 0.3) {
        if (Math.random() < 0.7) {
          count++;
        }
      }
      console.log(count / testTime);
    }

    testRandom();

    // [0, K) => [0, K-1] => [0, 8]
    function testKRandom() {
      var testTime = 10000000,
        K = 9,
        countObj = {};
      for (var i = 0; i < testTime; i++) {
        var num = parseInt(Math.random() * K);
        countObj[num] !== undefined ? countObj[num]++ : (countObj[num] = 0);
      }
      for (var key in countObj) {
        console.log('这个数 ' + key + ' 出现了' + countObj[key] + ' 次');
      }
    }

    testKRandom();

    // 上面的例子就表明 [0, x) 出现的次数是线性概率
    // [0, x) x 的出现概率 = 100%
    // 如果是想要将 x 出现的概率调整为 x*x = x的平方怎么搞

    // 返回 [0, 1) 的一个小数
    // 任意的 x，x 属于 [0,1), [0, x)范围上的数出现的概率由原来的 x 调整 x 的平方
    function xToXPower2() {
      return Math.max(Math.random(), Math.random());
    }
    function testX2Random() {
      var testTime = 10000000,
        count = 0,
        x = 0.6;
      for (var i = 0; i < testTime; i++) {
        if (xToXPower2() < x) {
          count++;
        }
      }
      console.log(count / testTime);
      console.log(Math.pow(x, 2));
    }

    testX2Random();

    // 调整成 x 的 3 次方
    function xToXPower3() {
      return Math.max(Math.random(), Math.max(Math.random(), Math.random()));
    }
    function testX3Random() {
      var testTime = 10000000,
        count = 0,
        x = 0.6;
      for (var i = 0; i < testTime; i++) {
        if (xToXPower3() < x) {
          count++;
        }
      }
      console.log(count / testTime);
      console.log(Math.pow(x, 3));
    }

    testX3Random();

    // 调整使用 min
    function xToXPower2Min() {
      return Math.min(Math.random(), Math.random());
    }
    function testX2RandomMin() {
      var testTime = 10000000,
        count = 0,
        x = 0.6;
      for (var i = 0; i < testTime; i++) {
        if (xToXPower2Min() < x) {
          count++;
        }
      }
      console.log(count / testTime);
      console.log(1 - Math.pow(1 - x, 2));
    }

    testX2RandomMin();

    // 题：等概率获取 1-5 范围的数函数改造为 => 等概率获取 1-7 范围的数函数
    // lib 中的函数不能修改
    function f1() {
      return parseInt(Math.random() * 5) + 1;
    }

    // 随机机制，只能用 f 函数
    // 01发生器 => 等概率返回 0 和 1
    function f2() {
      var ans = 0;
      do {
        ans = f1();
      } while (ans == 3);
      return ans < 3 ? 0 : 1;
    }

    console.log(f2());

    // 等概率获取 0-7 范围的函数
    // 利用二进制位，得到 000 ~ 111 做到等概率
    function f3() {
      var ans = (f2() << 2) + (f2() << 1) + (f2() << 0);
      return ans;
    }

    console.log(f3());

    // 等概率获取 0-6 范围的函数
    // 遇到 7 就重做
    function f4() {
      var ans = 0;
      do {
        ans = f3();
      } while (ans == 7);
      return ans;
    }

    console.log(f4());

    // 目标 g 函数，等概率获取 1-7 范围的数
    function g() {
      return f4() + 1;
    }

    console.log(g());

    // 例如: 17-56
    // => 56 - 17 = 39 => [0, 39] 随机概率的数 + 17
    // => 改造 01发生器看最大的数需要几个二进制位
    // => 56 需要 6 个二进制位，那么就将 01发生器 row 6 次
    // => 6 个二进制位就可以返回 [0, 63] 范围的数，如果 row 到的数比 39 大那么就重做
    // => [40, 63] 范围的数重做

    // 题：0 到 1 不等概率随机改造为 => 0 到 1 等概率随机
    // 只能知道，x 会以固定概率返回 0 和 1，但是 x 的内容看不到
    function x() {
      return Math.random() < 0.84 ? 0 : 1;
    }
    function y() {
      var ans = 0;
      do {
        ans = x();
      } while (ans == x());
      // ans = 0 1
      // ans = 1 0
      return ans;
    }

    console.log(y());
  </script>
</html>
