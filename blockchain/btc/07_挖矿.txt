全节点
1.一直在线
2.在本地硬盘上维护完整的区块链信息
3.在内存里维护utxo集合，以便快速检验交易的合法性
4.监听比特币网络上的交易信息，验证每个交易的合法性
5.决定哪些交易会被打包到区块内
6.监听别的矿工挖出来的区块，验证其合法性
  验证区块内交易的合法性，铸币交易是否被篡改，发布的区块是否符合难度要求
  每两周按照比特币协议规定调整挖矿难度，验证区块是否在最长合法链上
7.挖矿
  决定沿着哪个链挖下去，默认情况下按照最长合法链挖下去
  当出现等长分叉的时候，选择哪一条分叉，默认是按照最先监听到的区块

轻节点(spv client)
1.不是一直在线
2.不用保存整个区块链，只要保存每个区块的块头
3.不用保存全部交易，只保存与自己相关的交易
4.无法检验大多数交易的合法性，只能检验与自己相关的那些交易的合法性
5.无法检测网上发布区块的准确性
6.可以验证挖矿的难度
7.只能检测到哪条是最长链，不知道哪条是最长合法链

比特币是如何保证安全性的？
从两个方面进行，一方面是从密码学上来保证，另一方面是共识机制
密码学上保证其他人没有你的私钥就没有办法伪造你的签名，所以不可能把你帐上的钱转走
这个设计的前提是在网络中拥有大部分算力的矿工都是诚实的，不会接受那些不合法的交易(伪造签名)

第一代挖矿采用的是cpu
第二代挖矿是gpu
第三代挖矿是asic芯片

单个矿工的收入是不稳定，所以就产生了矿池
矿池是由多个矿机来驱动一个全节点
矿主将哈希值计算交给矿工处理，矿工计算好哈希值后提交给矿主

收益该如何分配呢？
例如原来的nonce是矿工要挖12年才能够挖到的目标数，矿主将目标数降低难度然后分配给矿工
矿工接收到后开始计算这个share(almost valid block)，只要矿工挖到了这个share把它提交给矿主
矿主拿到这个share后除了做为矿工的工作量证明，其它没有任何用处
矿主会记录矿工提交了多少次这个share，将来等到某个矿工真的挖到了合法的区块之后
按照每个矿工所做的工作量，提交的share数目进行分配收益，作为矿工工作量证明的一个衡量标准

有没有可能矿工会偷鸡？
例如矿工在计算出合法的nonce值后，不提交给矿主而是提交另一个share，这种方式是不可行的
矿工在计算矿主给定的share是由，矿主所提供的哈希值，这个哈希值是与block header里的merkle root hash关联
因为在铸币交易中输出的收款人是矿主，就算是矿工计算出目标数后，收款地址也不是自己的

当有矿池掌握了超过51%的算力后能够进行什么攻击？
1.分叉攻击
2.联合抵制(boycott)将某个用户的交易排除在区块外
